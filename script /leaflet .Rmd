---
title: "Leaflet"
author: "Ashlee, Margarita, Jocelyn, and Rob"
date: "4/12/2022"
output: html_document
---

```{r setup, include=FALSE, warning=FALSE,message=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introduction 
To begin working with Leaflet you will first need to download the package. Use install.packages("leaflet") download this package and load it onto your working script or console.
Leaflet is an open source JavaScript library used to build web mapping applications. It is designed for simplicity, performance and usability. 

# Libraries 
```{r, warning=FALSE, message=FALSE}
library(leaflet)
library(tidyverse)
library(dplyr)
```


# Data 
The data we will be using for our examples is based off of a Tidy Tuesday Dataset on [Volcano Eruptions](https://github.com/rfordatascience/tidytuesday/blob/master/data/2020/2020-05-12/readme.md)
```{r, warning=FALSE,message=FALSE}
# Get the Data

volcano <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-05-12/volcano.csv')
eruptions <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-05-12/eruptions.csv')
events <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-05-12/events.csv')
tree_rings <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-05-12/tree_rings.csv')
sulfur <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-05-12/sulfur.csv')

```
Wrangling Data 
```{r}
data <- full_join(volcano, eruptions) %>% 
  filter(last_eruption_year >= "1900") %>% 
  select(-major_rock_1, -major_rock_2, -major_rock_3, -major_rock_4, -major_rock_5,
         -minor_rock_1, -minor_rock_2, -minor_rock_3, -minor_rock_4, -minor_rock_5,
         -population_within_5_km, -population_within_10_km, -population_within_30_km, -population_within_100_km,
         -vei) %>% 
  drop_na()
```



# Base Map
Creating a standard basemap 

```{r, warning=FALSE, message=FALSE}

standard.basemap <- leaflet() %>% # leaflet 
 addTiles() %>% 
setView(lat= 37.5, lng=-95.5, zoom=3)

standard.basemap

```

Creating third-party basemaps can be done by searching for different colors and styles of map tiles. 
```{r}

blackandwhite.basemap <- standard.basemap %>% # leaflet 
addProviderTiles(providers$Stamen.Toner)

cartoon.basemap <- standard.basemap %>% # leaflet 
addProviderTiles(providers$CartoDB.Positron)

```

Combining Tile Layers 

```{r}

 basemap <- standard.basemap %>% 
  addProviderTiles(providers$Stamen.Watercolor) %>%
  addProviderTiles(providers$Stamen.TonerLines,
    options = providerTileOptions(opacity = 0.35)) %>% #change opacity
  addProviderTiles(providers$Stamen.TonerLabels)

 basemap

```

Adding Markers

```{r}

longitude <- data$longitude
latitude <- data$latitude
volcanonames <- data$volcano_name

volcanomap <- basemap %>% 
addCircleMarkers(lng = longitude, lat = latitude, popup = volcanonames, radius=3, color="#ffffd14", stroke=FALSE, fillOpacity=1) # add a single point layer

volcanomap

```

# Adding markers to maps

First we start with the base function to create a map.
```{r marker_basemap}
leaflet() %>%
  addTiles()
```

Then we can pin point on any given location using lat and long data, here is an example using Toya volcano in Japan. 

Icon markers can be added using the addMarkers() or addAwesomeMarkers() function.

Both functions work the same but differ in that the addAwesomeMarkers function allows you to use additional custom colors or icons from [Font Awesome](https://fontawesome.com/icons), [Bootstrap Glyphicons](https://getbootstrap.com/docs/5.1/components/accordion/), and [Ion icons](https://ionic.io/ionicons) icon libraries.

```{r first_marker}
leaflet(data) %>%
  addTiles() %>%
  addMarkers(lng = 140.839, #longitude value
             lat = 42.544) #latitude value

# example using addAwesomeMarkers
#leaflet(data = volcano) %>%
#  addTiles() %>%
#  addAwesomeMarkers(lng = 131.600, 
#                    lat = 34.500)
```

Interactive pop up labels can also be added to existing markers. Using the popup feature displays custom label when clicked on the marker.

```{r popup_marker}
leaflet(data) %>%
  addTiles() %>%
  addMarkers(lng = 140.8390, #longitude value
             lat = 42.544, #latitude value
             popup = "Toya volcano") #label name
```

Alternately, using the label option adds a hover feature to your label.

```{r label_marker}
leaflet(data) %>%
  addTiles() %>%
  addMarkers(lng = 140.839, #longitude value
             lat = 42.544, #latitude value
             label = "Toya volcano") #label name
```

# Customizing marker icons

Markers can be customized in any way, using any icon, image, or color.

For this example, we'll use the [leaflet icon](https://leafletjs.com/SlavaUkraini/examples/custom-icons/leaf-green.png).

To do this we'll create a function for our icon to make our code cleaner. Icon elements can be changed using icon and shadow functions. Icon functions are the base elements for customizing your icon and shadow functions add a 3D element to your icon.

```{r}
LeafIcon <- makeIcon( 
  iconUrl = "https://leafletjs.com/SlavaUkraini/examples/custom-icons/leaf-green.png", #leaf url
  iconWidth = 35, iconHeight = 95, #icon dimensions
  iconAnchorX = 20, iconAnchorY = 95, #iicon position dimensions
  shadowUrl = "https://leafletjs.com/SlavaUkraini/examples/custom-icons/leaf-shadow.png", #shadow url
  shadowWidth = 50, shadowHeight = 65, #shadow dimensions
  shadowAnchorX = 5, shadowAnchorY = 65 #icon position dimensions
  )
```

```{r LeafIcon}
leaflet(data) %>%
  addTiles() %>%
  addMarkers(lng = 140.839, #longitude value
             lat = 42.544, #latitude value
             icon = LeafIcon) #name for icon code
```

If you have more than one icon or point, the icons() function is used to add more than one icon onto your map.

```{r}
leafs <- icons(
  iconUrl = c("https://leafletjs.com/SlavaUkraini/examples/custom-icons/leaf-green.png", #green leaf icon
              "https://leafletjs.com/SlavaUkraini/examples/custom-icons/leaf-red.png"), #red leaf icon
  iconWidth = 35, iconHeight = 95, #icon dimensions
  iconAnchorX = 20, iconAnchorY = 95, #icon position dimensions
  shadowUrl = "https://leafletjs.com/SlavaUkraini/examples/custom-icons/leaf-shadow.png", #shadow icon
  shadowWidth = 50, shadowHeight = 65, #shadow dimensions
  shadowAnchorX = 5, shadowAnchorY = 65 #shadow position dimensions
  )
```

```{r}
longitudeval <- c(140.281, 145.030, 130.657, 144.013, 140.799) #5 longitude values
latitudeval <- c(37.647, 20.420, 31.593, 43.384, 39.761) #5 latitude values
```

```{r Leafs}
leaflet(data) %>%
  addTiles() %>%
  addMarkers(lng = longitudeval, #longitude function
             lat = latitudeval, #latitude function
             icon = leafs) #name for multiple icons code
```

# Customizable Icons with Awesome Icons

Using the addAwesomeMarkers() function, markers can be customized through their color and icons.

View more ion icons [here](https://ionic.io/ionicons).

```{r}
volcano_icon <- awesomeIcons(
  icon = "flame", #icon name
  iconColor = "red", #icon color
  library = "ion", #library where the icon is from
  markerColor = "white" #marker color
)
```

```{r volcano_icon}
leaflet(data) %>%
  addTiles() %>%
  addAwesomeMarkers(lng = longitudeval, #longitude function
                    lat = latitudeval, #latitude function
                    icon = volcano_icon) #name for icon function
```

# Marker Clusters

For many markers grouped together on a single map, the clusterOptions function can be used to group together several markers into one.

```{r}
# 10 long and lat values for volcanoes in japan
longitudevals <- c(140.281, 145.030, 130.657, 144.013, 140.799, 145.670, 138.523, 131.104, 140.244, 146.252)
latitudevals <- c(37.647, 20.420, 31.593, 43.384, 39.761, 16.350, 36.406, 32.884, 37.735, 44.353)
```

```{r cluster}
leaflet(data) %>% 
  addTiles() %>% 
  addMarkers(lng = longitudevals, #longitude function
             lat = latitudevals, #latitude function
             clusterOptions = markerClusterOptions()) #code for cluster option
```

# Circle Markers

Instead of the standard bubble markers, you can opt for circle markers.

```{r circle_markers}
leaflet(data) %>% 
  addTiles() %>%
  addCircleMarkers(lng = longitudevals, #simple circle marker, longitude function
                   lat = latitudevals) #latitude function
```

Circle markers can be customized by their color, opacity, etc. 

```{r aes_circle_markers}
colpal <- c("#FB7110", "#4D1104") #color palette function

leaflet(data) %>% 
  addTiles() %>%
  addCircleMarkers(lng = longitudevals, #simple circle marker, longitude function
                   lat = latitudevals, #latitude function
                   color = colpal, #color palette
                   stroke = FALSE, #circle border
                   fillOpacity = 0.5) #circle opacity
```

